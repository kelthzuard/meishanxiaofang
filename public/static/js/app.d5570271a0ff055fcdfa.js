webpackJsonp([1],{"+skl":function(t,e){},"/DBZ":function(t,e){},0:function(t,e){},DAVh:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("j1ja");var s=n("7+uW"),a=n("hKoQ"),i=n.n(a),o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var r=n("VU/8")({name:"App"},o,!1,function(t){n("TZDN")},null,null).exports,u=n("/ocq"),c={name:"admim",data:function(){return{deleteModal:!1,map:null,marker:null,deleteAim:"",newQuest:{phoneNumber:"",desc:""},currentPointer:"",currentDesc:"",startNew:!1,startNewLoading:!0,locationInfo:"",currentItem:"18380266573",numberList:[],sendMsgInfo:"重发短信",sendStatus:!1}},sockets:{connect:function(){console.log("socket connected")},map:function(t){this.$Message.info("电话号码为"+t.msg.phoneNumber+"的位置信息更新了");for(var e=0;e<this.numberList.length;e++)if(t.msg.phoneNumber===this.currentPointer&&this.numberList[e].phoneNumber===this.currentPointer){this.numberList[e]=t.msg,this.currentDesc=this.numberList[e].desc;var n=JSON.parse(this.numberList[e].location);this.locationInfo=n.formattedAddress,this.drawMarker(n)}}},methods:{changeItem:function(t){this.$refs.side_menu.updateActiveName(),this.currentPointer=t;for(var e=0;e<this.numberList.length;e++)if(t===this.numberList[e].phoneNumber)if(this.currentDesc=this.numberList[e].desc,"unknow"===this.numberList[e].location)this.marker&&this.map.remove(this.marker),this.map.setFitView(),this.map.panTo([116.397428,39.90923]),this.locationInfo="等待确认";else{var n=JSON.parse(this.numberList[e].location);this.locationInfo=n.formattedAddress,this.marker&&this.map.remove(this.marker),this.drawMarker(n)}},createMap:function(){var t=new AMap.Map("container",{resizeEnable:!0,zoom:11,center:[116.397428,39.90923]});this.map=t},drawMarker:function(t){var e=[];e[1]=t.position.Q,e[0]=t.position.R;var n=new AMap.Marker({icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",position:e});this.marker=n,this.map.add(n),this.map.setFitView()},getsocket:function(){this.$socket.emit("client message","admin")},startNewModal:function(){this.startNew=!0},cancleNew:function(){this.startNew=!1},isPoneAvailable:function(t){return!!/^[1][3,4,5,7,8][0-9]{9}$/.test(t)},deleteItem:function(t){this.deleteAim=this.numberList[t].phoneNumber,this.deleteModal=!0},sendDelete:function(){var t=this;this.$axios({method:"post",url:"/admin/delete",data:{phoneNumber:this.deleteAim}}).then(function(e){t.$Message.info("删除成功"),t.deleteModal=!1,t.getData()}).catch(function(e){t.$Message.error("删除失败"),t.deleteModal=!1})},cancleDelete:function(){this.deleteModal=!1},sendNewQuest:function(){var t=this,e=!1,n=this;""===this.newQuest.phoneNumber&&(this.$Message.error("电话号码不能为空"),e=!0),this.isPoneAvailable(this.newQuest.phoneNumber)||(this.$Message.error("请输入正确的电话号码"),e=!0),this.numberList.forEach(function(n){n.phoneNumber===t.newQuest.phoneNumber&&(t.$Message.error("此报警人已经存在"),e=!0)}),e?setTimeout(function(){t.startNewLoading=!1,t.$nextTick(function(){n.startNewLoading=!0})},1e3):this.$axios({method:"post",url:"/admin",data:{data:n.newQuest}}).then(function(e){t.$Message.info("新建成功"),t.startNew=!1,t.getData()}).catch(function(e){t.$Message.error("新建失败"),t.startNew=!1})},getData:function(){var t=this;this.$axios({method:"get",url:"/admin/getList"}).then(function(e){"notLogin"===e.data?t.$router.push({path:"/"}):t.numberList=e.data}).catch(function(e){t.$Message.error("获取列表失败")})},resendMsg:function(){var t=this;if(""===this.currentPointer)return this.$Message.error("请先选择报警人员"),!1;if(!this.sendStatus){this.sendStatus=!0;for(var e={phoneNumber:this.currentPointer,secretNumber:null},n=0;n<this.numberList.length;n++)this.currentPointer===this.numberList[n].phoneNumber&&(e.secretNumber=this.numberList[n].secretNumber);this.sendMsgInfo="正在发送",this.$axios({method:"post",url:"/admin/resendMsg",data:e}).then(function(e){t.$Message.info("发送成功"),t.sendMsgInfo="请等待",setTimeout(function(){t.sendStatus=!1,t.sendMsgInfo="重发短信"},5e3)}).catch(function(e){t.$Message.error("发送失败"),t.sendStatus=!1,t.sendMsgInfo="重发短信"})}}},mounted:function(){this.createMap(),this.getData()}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"layout"},[n("Layout",{staticStyle:{height:"100%"}},[n("Header",[n("Menu",{attrs:{mode:"horizontal",theme:"dark"}},[n("div",{staticClass:"headerTitle"},[t._v("眉山消防定位系统")]),t._v(" "),n("div",{staticClass:"layout-nav"})])],1),t._v(" "),n("Layout",[n("Sider",{style:{background:"#fff"},attrs:{"hide-trigger":""}},[n("Menu",{ref:"side_menu",attrs:{theme:"light",width:"auto","open-names":["1"]},on:{"on-select":t.changeItem}},[n("Submenu",{attrs:{name:"1"}},[n("template",{slot:"title"},[t._v("\n                            报警人员列表\n                        ")]),t._v(" "),t._l(t.numberList,function(e,s){return n("div",{key:s},[n("MenuItem",{attrs:{name:e.phoneNumber}},[t._v(t._s(e.phoneNumber)+"\n                            "),n("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.deleteItem(s)}}},[t._v("删除")])],1)],1)}),t._v(" "),n("Button",{staticStyle:{margin:"20px 0 0 40px"},attrs:{type:"primary"},on:{click:t.startNewModal}},[t._v("新建火灾信息")])],2)],1)],1),t._v(" "),n("Layout",{staticStyle:{position:"relative"}},[n("div",{staticStyle:{width:"100%",height:"100%"},attrs:{id:"container"}}),t._v(" "),n("Card",{staticClass:"infoCard"},[n("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n                      具体位置信息:\n                  ")]),t._v(" "),n("p",[t._v(t._s(this.locationInfo))]),t._v(" "),n("p",{staticStyle:{"word-wrap":"break-word"}},[n("b",[t._v("报警人描述信息:")]),t._v(t._s(this.currentDesc))]),t._v(" "),n("Button",{attrs:{type:"primary"},on:{click:function(e){return t.resendMsg()}}},[t._v(t._s(t.sendMsgInfo))])],1)],1)],1)],1),t._v(" "),n("Modal",{attrs:{loading:t.startNewLoading},on:{"on-cancle":t.cancleNew,"on-ok":t.sendNewQuest},model:{value:t.startNew,callback:function(e){t.startNew=e},expression:"startNew"}},[n("p",[t._v("报警人电话:"),n("Input",{staticStyle:{width:"200px"},model:{value:t.newQuest.phoneNumber,callback:function(e){t.$set(t.newQuest,"phoneNumber",e)},expression:"newQuest.phoneNumber"}})],1),t._v(" "),n("p",[t._v("报警人信息位置描述:"),n("Input",{attrs:{type:"textarea"},model:{value:t.newQuest.desc,callback:function(e){t.$set(t.newQuest,"desc",e)},expression:"newQuest.desc"}})],1)]),t._v(" "),n("Modal",{staticStyle:{"text-align":"center"},on:{"on-cancle":t.cancleDelete,"on-ok":t.sendDelete},model:{value:t.deleteModal,callback:function(e){t.deleteModal=e},expression:"deleteModal"}},[n("p",[t._v("是否删除电话号码为"+t._s(t.deleteAim)+"的位置信息?")])])],1)},staticRenderFns:[]};var d=n("VU/8")(c,l,!1,function(t){n("DAVh")},"data-v-678b6308",null).exports,h={name:"client",data:function(){return{info:"定位中，请等待"}},methods:{getLocation:function(){var t=this;AMap.plugin("AMap.Geolocation",function(){new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RB",buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0}).getCurrentPosition(function(e,n){"complete"==e?t.onComplete(n):t.info="定位失败"})})},onComplete:function(t){var e=this,n=this.$route.params.number;this.$axios({method:"post",url:"/client?number="+n,data:{data:t}}).then(function(t){e.info="定位成功"}).catch(function(t){e.info="网络失败"})}},mounted:function(){this.getLocation()}},m={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"info"},[this._v(this._s(this.info))])},staticRenderFns:[]};var p=n("VU/8")(h,m,!1,function(t){n("hr17")},"data-v-55dbf122",null).exports,f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Card",{staticClass:"card"},[n("p",{staticClass:"title"},[t._v("眉山市火灾消防定位系统")]),t._v(" "),n("div",{staticClass:"inputModal"},[n("span",[t._v("账号：")]),n("Input",{staticClass:"input",model:{value:t.userName,callback:function(e){t.userName=e},expression:"userName"}})],1),t._v(" "),n("div",{staticClass:"inputModal"},[n("span",[t._v("密码：")]),n("Input",{staticClass:"input",attrs:{type:"password"},model:{value:t.userPassword,callback:function(e){t.userPassword=e},expression:"userPassword"}})],1),t._v(" "),n("Button",{attrs:{type:"info"},on:{click:t.login}},[t._v("登录")])],1)},staticRenderFns:[]};var v=n("VU/8")({name:"login",data:function(){return{userName:"",userPassword:""}},methods:{login:function(){var t=this;""!==this.userName&&""!==this.userPassword?this.$axios({method:"post",url:"/login",data:{userName:this.userName,userPassword:this.userPassword}}).then(function(e){t.$router.push({path:"/admin"})}).catch(function(e){t.$Message.error("账号或密码错误")}):this.$Message.error("用户名或密码不能为空")}}},f,!1,function(t){n("/DBZ")},null,null).exports;s.default.use(u.a);var g=new u.a({routes:[{path:"/",name:"login",component:v},{path:"/admin",name:"admin",component:d},{path:"/client/:number",name:"client",component:p}]}),b=n("BTaQ"),w=n.n(b),M=(n("+skl"),n("mtWM")),N=n.n(M),_=(n("Rf8U"),n("HI0L")),k=n.n(_);n("DmT9");n("hKoQ").polyfill(),i.a.polyfill(),s.default.config.productionTip=!1,s.default.use(w.a),s.default.use(new k.a({debug:!1,connection:"//firelocater.top"})),N.a.defaults.baseURL="//firelocater.top/",s.default.prototype.$axios=N.a,new s.default({el:"#app",router:g,components:{App:r},template:"<App/>"})},TZDN:function(t,e){},hr17:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.d5570271a0ff055fcdfa.js.map